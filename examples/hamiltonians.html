<!-- This file displays the animated SVG link to the GitHub repository 
in the top right corner -->


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Defining Hamiltonians as Linear Combinations of Pauli Strings &#8212; Mitiq 0.17.0dev documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles/pydata-sphinx-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mitiq paper codeblocks" href="mitiq-paper/mitiq-paper-codeblocks.html" />
    <link rel="prev" title="Solving MaxCut with Mitiq-improved QAOA" href="maxcut-demo.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/mitiq-logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../readme.html">
  <a href="https://github.com/unitaryfund/mitiq">
  </a>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../guide/guide.html">
  Users Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../apidoc.html">
  API-doc
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../toc_contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../changelog.html">
  Changelog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../zz_bibliography.html">
  References
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="braket_mirror_circuit.html">
   Mirror circuit benchmark improved with zero-noise extrapolation on AWS Braket
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ibmq-backends.html">
   Zero-noise extrapolation on IBMQ backends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pyquil_demo.html">
   Zero-noise extrapolation on PyQuil parametric programs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vqe-pyquil-demo.html">
   Variational quantum eigensolver improved with zero-noise extrapolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="simple_landscape.html">
   Variational circuit mitigation with zero-noise extrapolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="maxcut-demo.html">
   MaxCut benchmark with zero-noise extrapolation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Defining a Mitiq executor with a hamiltonian
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mitiq-paper/mitiq-paper-codeblocks.html">
   Mitiq paper codeblocks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="molecular_hydrogen.html">
   Estimating the potential energy surface of molecular Hydrogen with ZNE
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-the-hamiltonian">
   Defining the Hamiltonian
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-hamiltonian-in-the-executor">
   Using the Hamiltonian in the executor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-usage">
   Example usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sampling">
   Sampling
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
    
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="defining-hamiltonians-as-linear-combinations-of-pauli-strings">
<h1>Defining Hamiltonians as Linear Combinations of Pauli Strings<a class="headerlink" href="#defining-hamiltonians-as-linear-combinations-of-pauli-strings" title="Permalink to this headline">#</a></h1>
<p>This tutorial shows an example of using Hamiltonians defined as <code class="xref py py-class docutils literal notranslate"><span class="pre">PauliSum</span></code> objects or similar objects in other
supported frontends. The usage of these Hamiltonian-like objects does not change the interface with Mitiq, but we
show an example for users who prefer these constructions.</p>
<p>Specifically, in this tutorial we will mitigate the expectation value of the Hamiltonian</p>
<div class="math notranslate nohighlight">
\[
H := 1.5 X_1 Z_2 - 0.7 Y_1
\]</div>
<p>on two qubits.</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>First we import libraries for this example.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">cirq</span>
<span class="kn">from</span> <span class="nn">mitiq.zne</span> <span class="kn">import</span> <span class="n">execute_with_zne</span>
<span class="kn">from</span> <span class="nn">mitiq.zne.inference</span> <span class="kn">import</span> <span class="n">LinearFactory</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-the-hamiltonian">
<h2>Defining the Hamiltonian<a class="headerlink" href="#defining-the-hamiltonian" title="Permalink to this headline">#</a></h2>
<p>Now we define the Hamiltonian as a <code class="xref py py-class docutils literal notranslate"><span class="pre">PauliSum</span></code> by defining the Pauli strings <span class="math notranslate nohighlight">\(X_1 Z_2\)</span> and <span class="math notranslate nohighlight">\(Y_1\)</span> then
taking a linear combination of these to create the Hamiltonian above.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Qubit register</span>
<span class="n">qreg</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Two Pauli operators</span>
<span class="n">string1</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">PauliString</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qreg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qreg</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">string2</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">PauliString</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qreg</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Hamiltonian</span>
<span class="n">ham</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">string1</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">string2</span>
</pre></div>
</div>
<p>By printing the Hamiltonian we see:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span>
<span class="go">1.500*X(0)*Z(1)-0.700*Y(1)</span>
</pre></div>
</div>
<p>Note that we could have created the Hamiltonian by directly defining a <code class="xref py py-class docutils literal notranslate"><span class="pre">PauliSum</span></code> with the coefficients.</p>
</div>
<div class="section" id="using-the-hamiltonian-in-the-executor">
<h2>Using the Hamiltonian in the executor<a class="headerlink" href="#using-the-hamiltonian-in-the-executor" title="Permalink to this headline">#</a></h2>
<p>To interface with Mitiq, we define an <code class="docutils literal notranslate"><span class="pre">executor</span></code> function which maps an input (noisy) circuit to an expectation
value. In the code block below, we show how to define this function and return the expectation of the Hamiltonian above.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">executor</span><span class="p">(</span>
    <span class="n">circuit</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">,</span>
    <span class="n">hamiltonian</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">PauliSum</span><span class="p">,</span>
    <span class="n">noise_value</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Runs the circuit and returns the expectation value of the Hamiltonian.</span>

<span class="sd">    Args:</span>
<span class="sd">        circuit: Defines the ansatz wavefunction.</span>
<span class="sd">        hamiltonian: Hamiltonian to compute the expectation value of w.r.t. the ansatz wavefunction.</span>
<span class="sd">        noise_value: Probability of depolarizing noise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add noise</span>
    <span class="n">noisy_circuit</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">with_noise</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">depolarize</span><span class="p">(</span><span class="n">noise_value</span><span class="p">))</span>

    <span class="c1"># Get the final density matrix</span>
    <span class="n">dmat</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">DensityMatrixSimulator</span><span class="p">()</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">noisy_circuit</span><span class="p">)</span><span class="o">.</span><span class="n">final_density_matrix</span>

    <span class="c1"># Return the expectation value</span>
    <span class="k">return</span> <span class="n">hamiltonian</span><span class="o">.</span><span class="n">expectation_from_density_matrix</span><span class="p">(</span>
        <span class="n">dmat</span><span class="p">,</span>
        <span class="n">qubit_map</span><span class="o">=</span><span class="p">{</span><span class="n">ham</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="o">.</span><span class="n">qubits</span><span class="p">))}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">real</span>
</pre></div>
</div>
<p>This executor inputs a Hamiltonian as well as a noise value, adds noise, then uses the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">cirq.PauliSum.expectation_from_density_matrix()</span></code> method to return the expectation value.</p>
<p>The remaining interface is as usual with Mitiq. For the sake of example, we show an application mitigating the
expectation value of <span class="math notranslate nohighlight">\(H\)</span> with an example ansatz at different noise levels.</p>
</div>
<div class="section" id="example-usage">
<h2>Example usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">#</a></h2>
<p>Below we create an example ansatz parameterized by one angle <span class="math notranslate nohighlight">\(\gamma\)</span>.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ansatz</span><span class="p">(</span><span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns the ansatz circuit.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">(</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">qreg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">CNOT</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="o">*</span><span class="n">qreg</span><span class="p">),</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">gamma</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">on_each</span><span class="p">(</span><span class="n">qreg</span><span class="p">),</span>
        <span class="n">cirq</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">CNOT</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="o">*</span><span class="n">qreg</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>For the angle <span class="math notranslate nohighlight">\(\gamma = \pi\)</span>, this ansatz has the following structure:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ansatz</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="go">0: ───Ry(π)───@───Rx(0.5π)───@───</span>
<span class="go">              │              │</span>
<span class="go">1: ───────────X───Rx(0.5π)───X───</span>
</pre></div>
</div>
<p>We now compute expectation values of <span class="math notranslate nohighlight">\(H\)</span> using the <code class="docutils literal notranslate"><span class="pre">executor</span></code> as follows.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">pvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">expvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="p">(</span><span class="n">ansatz</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">ham</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pvals</span><span class="p">]</span>
</pre></div>
</div>
<p>We can compute mitigated expectation values at these same noise levels by running the following. Here, we use a
<a class="reference internal" href="../apidoc.html#mitiq.zne.inference.LinearFactory" title="mitiq.zne.inference.LinearFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearFactory</span></code></a> and use the <code class="docutils literal notranslate"><span class="pre">partial</span></code> function to update the <code class="docutils literal notranslate"><span class="pre">executor</span></code> for each noise value. The latter point
ensures <code class="docutils literal notranslate"><span class="pre">this_executor</span></code> has the correct signature (input circuit, output float) to use with <a class="reference internal" href="../apidoc.html#mitiq.zne.zne.execute_with_zne" title="mitiq.zne.zne.execute_with_zne"><code class="xref py py-func docutils literal notranslate"><span class="pre">execute_with_zne()</span></code></a>.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">fac</span> <span class="o">=</span> <span class="n">LinearFactory</span><span class="p">(</span><span class="n">scale_factors</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
<span class="n">mitigated_expvals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pvals</span><span class="p">:</span>
    <span class="n">this_executor</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">executor</span><span class="p">,</span> <span class="n">hamiltonian</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">noise_value</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
    <span class="n">mitigated_expvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">execute_with_zne</span><span class="p">(</span><span class="n">ansatz</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">this_executor</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">fac</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>We can now visualize the effect that error mitigation has by running the following code for plotting.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.family&quot;</span><span class="p">:</span> <span class="s2">&quot;serif&quot;</span><span class="p">,</span> <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">expvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">expvals</span><span class="p">,</span> <span class="s2">&quot;--o&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unmitigated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">mitigated_expvals</span><span class="p">,</span> <span class="s2">&quot;--o&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mitigated&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Noise level&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\langle H \rangle$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This produces a plot of expectation value (unmitigated and mitigated) <span class="math notranslate nohighlight">\(\langle H \rangle\)</span> vs. noise strength
<span class="math notranslate nohighlight">\(p\)</span>. We include the true (noiseless) expectation value on the plot for comparison.</p>
<a class="reference internal image-reference" href="../_images/vqe-cirq-pauli-sum-mitigation-plot.png"><img alt="Mitigated vs unmitigated expectation values at different noise strengths." src="../_images/vqe-cirq-pauli-sum-mitigation-plot.png" style="width: 400px;" /></a>
<p>As we can see, the mitigated expectation values are closer, on average, to the true expectation value.</p>
</div>
<div class="section" id="sampling">
<h2>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">#</a></h2>
<p>Finally, we note that <span class="math notranslate nohighlight">\(\langle H \rangle\)</span> can be estimated by sampling using the <code class="xref py py-class docutils literal notranslate"><span class="pre">cirq.PauliSumCollector</span></code>. An
example of a <code class="docutils literal notranslate"><span class="pre">sampling_executor</span></code> which uses this is shown below.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sampling_executor</span><span class="p">(</span>
    <span class="n">circuit</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">,</span>
    <span class="n">hamiltonian</span><span class="p">:</span> <span class="n">cirq</span><span class="o">.</span><span class="n">PauliSum</span><span class="p">,</span>
    <span class="n">noise_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">nsamples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Runs the circuit and returns the expectation value of the Hamiltonian.</span>

<span class="sd">    Args:</span>
<span class="sd">        circuit: Defines the ansatz wavefunction.</span>
<span class="sd">        hamiltonian: Hamiltonian to compute the expectation value of w.r.t. the ansatz wavefunction.</span>
<span class="sd">        noise_value: Probability of depolarizing noise.</span>
<span class="sd">        nsamples: Number of samples to take per each term of the Hamiltonian.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add noise</span>
    <span class="n">noisy_circuit</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">with_noise</span><span class="p">(</span><span class="n">cirq</span><span class="o">.</span><span class="n">depolarize</span><span class="p">(</span><span class="n">noise_value</span><span class="p">))</span>

    <span class="c1"># Do the sampling</span>
    <span class="n">psum</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">PauliSumCollector</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">ham</span><span class="p">,</span> <span class="n">samples_per_term</span><span class="o">=</span><span class="n">nsamples</span><span class="p">)</span>
    <span class="n">psum</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">cirq</span><span class="o">.</span><span class="n">Simulator</span><span class="p">())</span>

    <span class="c1"># Return the expectation value</span>
    <span class="k">return</span> <span class="n">psum</span><span class="o">.</span><span class="n">estimated_energy</span><span class="p">()</span>
</pre></div>
</div>
<p>This executor can be used in the same way as the previously defined <code class="docutils literal notranslate"><span class="pre">executor</span></code> which used a density matrix simulation
to evaluate <span class="math notranslate nohighlight">\(\langle H \rangle\)</span>.</p>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="maxcut-demo.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Solving MaxCut with Mitiq-improved QAOA</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="mitiq-paper/mitiq-paper-codeblocks.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Mitiq paper codeblocks</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          
    
<!--
    Adds link to GitHub repository as an animated SVG in the top-right corner
    of the documentation.
    
    Source: github-corners https://github.com/tholman/github-corners

    License:
    The MIT License (MIT)

    Copyright (c) 2016 Tim Holman

    Permission is hereby granted, free of charge, to any person obtaining a
    copy of this software and associated documentation files (the "Software"),
    to deal in the Software without restriction, including without limitation 
    the rights to use, copy, modify, merge, publish, distribute, sublicense, 
    and/or sell copies of the Software, and to permit persons to whom the 
    Software is furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in 
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
    DEALINGS IN THE SOFTWARE.
-->
<a href="https://github.com/unitaryfund/mitiq" class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 60; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>



      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Tech Team @ Unitary Fund.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>